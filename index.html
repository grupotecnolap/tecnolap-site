<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grupo Tecnolap EIRL ‚Äî Equipos de C√≥mputo, Impresoras y CCTV</title>
  <meta name="description" content="Laptops, impresoras, CCTV, UPS y soporte t√©cnico. Cotiza por WhatsApp." />
  <link rel="icon" href="/favicon.ico" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- SEO / Social -->
  <link rel="canonical" href="https://grupotecnolap.com/" />
  <meta property="og:title" content="Grupo Tecnolap EIRL ‚Äî Equipos de C√≥mputo, Impresoras y CCTV">
  <meta property="og:description" content="Laptops, impresoras, CCTV, UPS y soporte t√©cnico. Cotiza por WhatsApp.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://grupotecnolap.com/">
  <meta property="og:image" content="https://grupotecnolap.com/img/hero-1.jpg">
  <meta name="twitter:card" content="summary_large_image">

  <style>
    :root{
      --bg:#0b1020; --card:#0f1530; --muted:#8ea0bf; --text:#eaf1ff;
      --brand:#4fc3f7; --brand-2:#7c4dff; --ok:#18d47b;
      --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(79,195,247,.25), transparent 60%),
        radial-gradient(1200px 600px at 110% 10%, rgba(124,77,255,.22), transparent 60%),
        var(--bg);
      color:var(--text);font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif
    }
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:24px}

    /* Topbar */
    .topbar{
      display:flex;justify-content:center;align-items:center;gap:16px;
      padding:8px 12px;font-size:13px;color:#eaf1ff;background:linear-gradient(90deg, rgba(79,195,247,.15), rgba(124,77,255,.15));
      border-bottom:1px solid rgba(255,255,255,.08)
    }
    .topbar .chip{padding:6px 10px;border:1px solid rgba(255,255,255,.18);border-radius:999px;background:rgba(255,255,255,.03)}
    .topbar strong{font-weight:800}

    /* Nav */
    header{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,rgba(11,16,32,.9),rgba(11,16,32,.6));backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,.06)}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:42px;height:42px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(135deg,var(--brand),var(--brand-2));box-shadow:var(--shadow);font-weight:800}
    nav{display:flex;align-items:center;gap:12px}
    nav a{opacity:.9}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:12px 18px;border-radius:999px;background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#061019;font-weight:700;box-shadow:var(--shadow);border:0;cursor:pointer}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.15);background:transparent;color:var(--text);cursor:pointer}
    .badge{display:inline-grid;place-items:center;min-width:18px;height:18px;border-radius:10px;background:#fff;color:#000;font-size:11px;padding:0 6px}
    /* mobile menu */
    #menuToggle{display:none}

    /* Layouts */
    .hero{display:grid;grid-template-columns:1.15fr .85fr;gap:28px;align-items:center;margin-top:18px}
    .hero h1{font-size:clamp(28px,5vw,48px);line-height:1.05;margin:0 0 10px}
    .hero p{color:var(--muted);margin:0 0 18px}
    .kpis{display:flex;gap:14px;flex-wrap:wrap;margin-top:8px}
    .kpis .item{background:#0f1530;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:10px 14px;color:var(--muted)}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .mini{font-size:12px;color:var(--muted)}
    .cta{display:flex;gap:14px;flex-wrap:wrap;margin-top:14px}

    /* Carousel */
    .carousel{position:relative;height:340px;border-radius:16px;overflow:hidden}
    .slide{position:absolute;inset:0;opacity:0;transition:opacity 800ms ease;background:#0b1020}
    .slide img{width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.05)}
    .slide.active{opacity:1}
    .dots{position:absolute;left:50%;bottom:10px;transform:translateX(-50%);display:flex;gap:8px}
    .dots button{width:9px;height:9px;border-radius:50%;border:0;background:rgba(255,255,255,.45);cursor:pointer}
    .dots button.active{background:#fff}

    /* Toolbar */
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 12px}
    .toolbar input,.toolbar select,.toolbar label{
      background:#0f1530;border:1px solid rgba(255,255,255,.12);
      color:var(--text);border-radius:12px;padding:10px 12px;outline:none
    }
    .toolbar input[type="search"]{min-width:280px;flex:1}

    /* Categoria chips */
    .tabs{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:8px}
    .tab{padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.15);cursor:pointer;color:var(--muted);background:transparent;white-space:nowrap}
    .tab.active{background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#061019;border-color:transparent;font-weight:700}

    /* Segmentos (solo laptops) */
    details.segmentos{margin:6px 0 14px}
    .segwrap{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .seg{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.15);display:inline-flex;gap:8px;align-items:center}
    .seg input{accent-color:#7c4dff}

    /* Productos */
    .products .item img{
      width:100%;height:160px;object-fit:contain;border-radius:14px;background:#0d1326;
    }
    .products .item h3{margin:10px 0 4px;font-size:18px}
    .item.disabled{opacity:.75}
    .soldout{
      position:absolute; top:10px; left:10px;
      background:#f33; color:#fff; font-weight:700;
      padding:4px 8px; border-radius:8px; font-size:12px;
    }
    .codePill{
      position:absolute; top:10px; right:10px;
      background:rgba(255,255,255,.95); color:#111;
      padding:4px 8px; border-radius:8px; font-size:12px; font-weight:700;
      box-shadow:var(--shadow)
    }
    .offerRibbon{
      position:absolute; top:12px; left:-12px;
      background:linear-gradient(135deg,#ff3366,#ff6b00);
      color:#fff; font-weight:800; font-size:12px;
      padding:6px 14px; border-radius:10px; transform:rotate(-10deg);
      box-shadow:var(--shadow); letter-spacing:.5px
    }

    /* Modal producto */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:200}
    .modal.open{display:flex}
    .modal__overlay{position:absolute;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(2px)}
    .modal__box{position:relative;z-index:1;display:grid;grid-template-columns:1.1fr .9fr;gap:18px;width:min(100%,980px);background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    .modal__close{position:absolute;top:8px;right:8px;border:0;background:transparent;color:var(--text);font-size:20px;cursor:pointer;opacity:.8}
    .modal__left{min-height:360px}
    .gallery{position:relative;border-radius:14px;overflow:hidden;background:#0a0f1f}
    .gallery img{width:100%;height:360px;object-fit:contain;display:block;background:#0a0f1f}
    .galBtn{position:absolute;top:50%;transform:translateY(-50%);border:0;background:rgba(0,0,0,.35);color:#fff;width:36px;height:36px;border-radius:50%;cursor:pointer}
    .galPrev{left:8px}.galNext{right:8px}
    .thumbs{display:flex;gap:8px;margin-top:8px;overflow:auto}
    .thumbs img{width:64px;height:48px;object-fit:cover;border-radius:8px;opacity:.7;cursor:pointer;border:1px solid rgba(255,255,255,.15)}
    .thumbs img.active{opacity:1;border-color:#fff}
    .modal__right h3{margin:0 0 2px}

    /* Drawer carrito */
    .drawerOverlay{position:fixed;inset:0;background:rgba(0,0,0,.5);opacity:0;pointer-events:none;transition:.2s;z-index:220}
    .drawerOverlay.open{opacity:1;pointer-events:auto}
    .drawer{position:fixed;top:0;right:-420px;width:380px;max-width:90vw;height:100vh;background:var(--card);border-left:1px solid rgba(255,255,255,.1);box-shadow:var(--shadow);padding:16px;z-index:221;transition:right .25s ease}
    .drawer.open{right:0}
    .cartHead{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .cartList{display:flex;flex-direction:column;gap:10px;max-height:55vh;overflow:auto;margin:10px 0}
    .cartItem{display:grid;grid-template-columns:64px 1fr auto;gap:10px;align-items:center;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:8px}
    .cartItem img{width:64px;height:48px;object-fit:cover;border-radius:8px}
    .qty{display:inline-flex;align-items:center;border:1px solid rgba(255,255,255,.15);border-radius:999px}
    .qty button{border:0;background:transparent;color:#fff;width:28px;height:28px;cursor:pointer}
    .qty span{display:inline-block;min-width:26px;text-align:center}
    .cartFoot{border-top:1px solid rgba(255,255,255,.12);padding-top:10px;display:grid;gap:10px}
    .row{display:flex;justify-content:space-between;align-items:center}
    .del{border:0;background:transparent;color:#f88;cursor:pointer}
    .empty{color:var(--muted);text-align:center;margin:30px 0}

    footer{margin:40px 0 20px;color:var(--muted);text-align:center}

    /* ====== RESPONSIVE ====== */
    @media (max-width:1000px){
      .grid{grid-template-columns:repeat(2,1fr)}
    }
    @media (max-width:900px){
      .hero{grid-template-columns:1fr}
      .carousel{height:280px}
      .modal__box{grid-template-columns:1fr; width:min(96vw,720px)}
      .gallery img{height:300px}
      .thumbs img{width:56px;height:44px}
    }
    @media (max-width:700px){
      /* men√∫ compacto */
      #menuToggle{display:inline-flex}
      nav{flex-basis:100%;justify-content:space-between}
      .navActions{display:none;flex-wrap:wrap;gap:10px}
      .navActions.open{display:flex}
      .pill,.btn{padding:10px 14px}
      .grid{grid-template-columns:1fr}
      .carousel{height:240px}
      .products .item img{height:150px}
      .tabs{overflow:auto; white-space:nowrap; padding-bottom:6px}
      .topbar{gap:8px; overflow:auto; white-space:nowrap}
      .modal__left{min-height:auto}
      .gallery img{height:260px}
      .drawer{width:100%; right:-100%}
    }
    @media (max-width:420px){
      .products .item h3{font-size:16px}
      .codePill{font-size:11px}
      .offerRibbon{font-size:11px; padding:6px 12px}
      .gallery img{height:220px}
    }
  </style>
</head>
<body>
  <!-- TOPBAR -->
  <div class="topbar">
    <span class="chip">üöö <strong>Env√≠os todos los d√≠as</strong> a todo el Per√∫</span>
    <span class="chip">‚ö° Entrega 24‚Äì48h Lima</span>
    <span class="chip">üí≥ Transferencia ‚Ä¢ Yape ‚Ä¢ Plin</span>
    <span class="chip">üõ°Ô∏è Garant√≠a oficial</span>
  </div>

  <header>
    <div class="container nav">
      <div class="brand">
        <div class="logo">TL</div>
        <div>
          <strong>Grupo Tecnolap EIRL</strong>
          <div class="mini">Hardware ‚Ä¢ Software ‚Ä¢ Soporte</div>
        </div>
      </div>

      <!-- bot√≥n hamburguesa -->
      <button id="menuToggle" class="pill" aria-label="Men√∫">‚ò∞</button>

      <nav class="navActions" id="navActions">
        <a href="#catalogo">Cat√°logo</a>
        <a href="#servicios">Servicios</a>
        <a href="#contacto" class="pill">Contacto</a>
        <button id="btnCart" class="pill">üõí Carrito <span id="cartCount" class="badge">0</span></button>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- HERO + CAROUSEL -->
    <section class="hero">
      <div>
        <h1>Tu partner tecnol√≥gico en Lima y provincias</h1>
        <p>Venta de laptops, PCs, impresoras, CCTV, UPS y m√°s. Instalaci√≥n, mantenimiento y soporte t√©cnico.</p>
        <div class="kpis">
          <div class="item">Garant√≠a oficial</div>
          <div class="item">Atenci√≥n a empresas</div>
          <div class="item">Env√≠os a todo el Per√∫</div>
        </div>
        <div class="cta">
          <a class="btn" id="cta-whatsapp" href="#">üí¨ Cotiza por WhatsApp</a>
          <a class="pill" href="#catalogo">Ver cat√°logo</a>
        </div>
      </div>
      <div class="card">
        <div class="carousel" id="carousel">
          <div class="slide active"><img src="img/hero-1.jpg" alt="Laptop empresarial" onerror="this.src='https://images.unsplash.com/photo-1517336714731-489689fd1ca8?q=80&w=1200&auto=format&fit=crop'"/></div>
          <div class="slide"><img src="img/hero-2.jpg" alt="Impresoras" onerror="this.src='https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=1200&auto=format&fit=crop'"/></div>
          <div class="slide"><img src="img/hero-3.jpg" alt="C√°maras de seguridad" onerror="this.src='https://images.unsplash.com/photo-1581726707445-75cbe9d70a41?q=80&w=1200&auto=format&fit=crop'"/></div>
          <div class="dots" id="dots"></div>
        </div>
      </div>
    </section>

    <!-- CATALOGO -->
    <section id="catalogo" style="margin-top:26px">
      <h2>Cat√°logo</h2>

      <div class="toolbar">
        <input id="q" type="search" placeholder="Buscar (marca, modelo, c√≥digo, categor√≠a)..." />
        <select id="sort">
          <option value="recientes">Ordenar: Recientes</option>
          <option value="precio-asc">Precio: menor a mayor</option>
          <option value="precio-desc">Precio: mayor a menor</option>
          <option value="nombre-asc">Nombre A‚ÄìZ</option>
          <option value="nombre-desc">Nombre Z‚ÄìA</option>
        </select>
      </div>

      <div class="tabs" id="tabs">
        <button type="button" class="tab active" data-cat="todo">Todo</button>
        <button type="button" class="tab" data-cat="laptops">Laptops</button>
        <button type="button" class="tab" data-cat="impresoras">Impresoras</button>
        <button type="button" class="tab" data-cat="cctv">C√°maras & CCTV</button>
        <button type="button" class="tab" data-cat="ups">UPS</button>
        <button type="button" class="tab" data-cat="pcs">PCs</button>
      </div>

      <!-- Segmentos (solo visible cuando se selecciona Laptops o Todo) -->
      <details class="segmentos" id="segBox" open style="display:none">
        <summary class="mini">Segmento (Laptops)</summary>
        <div class="segwrap">
          <label class="seg"><input type="checkbox" value="consumo"  class="segchk"> Consumo</label>
          <label class="seg"><input type="checkbox" value="empresarial" class="segchk"> Empresarial/Workstation</label>
          <label class="seg"><input type="checkbox" value="gamer" class="segchk"> Gamer</label>
          <label class="seg"><input type="checkbox" value="refurb" class="segchk"> Refurb</label>
          <button class="pill" id="segClear" type="button">Limpiar</button>
        </div>
      </details>

      <div class="grid products" id="productGrid"></div>
    </section>

    <section id="servicios" style="margin-top:26px">
      <h2>Servicios</h2>
      <div class="card">
        <ul>
          <li>üîß Mantenimiento de PCs, laptops e impresoras</li>
          <li>üõ°Ô∏è Soporte t√©cnico y contratos para empresas</li>
          <li>üì¶ Implementaci√≥n de redes y gabinetes</li>
          <li>üìπ Instalaci√≥n de CCTV y monitoreo</li>
          <li>üíª Formateo, backup y migraci√≥n</li>
        </ul>
      </div>
    </section>

    <section id="contacto" style="margin-top:26px">
      <h2>Contacto</h2>
      <div class="card">
        <p>üìû <strong id="telMostrar"></strong> &nbsp;‚Ä¢&nbsp; ‚úâÔ∏è <strong id="mailMostrar"></strong> &nbsp;‚Ä¢&nbsp; üìç Lima, Per√∫</p>
        <div class="cta">
          <a class="btn" id="cta-mail" href="#">Pedir cotizaci√≥n</a>
          <a class="pill" id="cta-whatsapp-2" href="#">WhatsApp</a>
        </div>
      </div>
    </section>
  </main>

  <footer>
    ¬© <span id="y"></span> Grupo Tecnolap EIRL ¬∑ RUC 20614167026 ¬∑ 
    <a href="politica.html">Pol√≠tica de Privacidad</a> ¬∑ 
    <a href="terminos.html">T√©rminos y Condiciones</a>
  </footer>

  <!-- MODAL PRODUCTO -->
  <div id="productModal" class="modal">
    <div class="modal__overlay" onclick="closeProduct()"></div>
    <div class="modal__box">
      <button class="modal__close" aria-label="Cerrar" onclick="closeProduct()">‚úï</button>
      <div class="modal__left">
        <div class="gallery" id="gal">
          <span id="galOffer" class="offerRibbon" style="display:none">OFERTA</span>
          <img id="galMain" src="" alt="" />
          <button class="galBtn galPrev" onclick="galPrev()" aria-label="Anterior">‚Äπ</button>
          <button class="galBtn galNext" onclick="galNext()" aria-label="Siguiente">‚Ä∫</button>
        </div>
        <div class="thumbs" id="galThumbs"></div>
      </div>
      <div class="modal__right">
        <h3 id="pdName"></h3>
        <div class="mini" id="pdRef"></div>
        <div class="mini" id="pdCat"></div>
        <div style="font-weight:800;margin:6px 0 10px" id="pdPrice"></div>
        <p id="pdDetalles"></p>
        <ul id="pdSpecs" class="mini" style="margin:10px 0 16px;line-height:1.5"></ul>
        <div class="cta">
          <button class="btn" id="pdAdd">Agregar al carrito</button>
          <a class="pill" id="pdWA" target="_blank" rel="noopener">Cotizar por WhatsApp</a>
        </div>
      </div>
    </div>
  </div>

  <!-- DRAWER CARRITO -->
  <div id="drawerOverlay" class="drawerOverlay"></div>
  <aside id="cartDrawer" class="drawer">
    <div class="cartHead">
      <strong>üõí Carrito</strong>
      <button class="pill" id="btnCloseCart">Cerrar</button>
    </div>
    <div id="cartList" class="cartList"></div>
    <div class="cartFoot">
      <div class="row"><span>Subtotal</span><strong id="cartSubtotal">S/ 0.00</strong></div>
      <div class="row"><span>IGV (18%)</span><strong id="cartIGV">S/ 0.00</strong></div>
      <div class="row"><span>Total</span><strong id="cartTotal">S/ 0.00</strong></div>
      <button id="btnCheckout" class="btn">Finalizar por WhatsApp</button>
      <button id="btnClear" class="pill">Vaciar carrito</button>
    </div>
  </aside>

  <script>
  // ====== CONTACTO ======
  const WA_PHONE = '51912811769';
  const TEL_SHOW = '+51 912 811 769';
  const MAIL = 'ventas@grupotecnolap.com';

  document.getElementById('telMostrar').textContent = TEL_SHOW;
  document.getElementById('mailMostrar').textContent = MAIL;
  const waLink = (msg='Hola Tecnolap, quiero una cotizaci√≥n') =>
    `https://wa.me/${WA_PHONE}?text=${encodeURIComponent(msg)}`;
  document.getElementById('cta-whatsapp').href = waLink();
  document.getElementById('cta-whatsapp-2').href = waLink();
  document.getElementById('cta-mail').href =
    `mailto:${MAIL}?subject=Cotizaci√≥n%20Tecnolap&body=Hola,%20necesito%20cotizaci√≥n.`;

  // ====== PRECIOS ======
  let TC = parseFloat(localStorage.getItem('TC_val') || '3.39');
  const RECARGO_PCT  = 0.03;
  const RECARGO_FIJO = 110;
  const MARGEN_LOW_LAPTOP_SINIGV = 100;

  function round50(n){
    const soles = Math.floor(n);
    const cents = Math.round((n - soles) * 100);
    if (cents <= 9) return soles;
    if (cents <= 59) return soles + 0.50;
    return soles + 1.00;
  }

  function calcFinal({usd=null, pen=null, igvIncluido=false}, cat=''){
    let base = usd!=null ? usd*TC : (pen ?? 0);
    if(!igvIncluido) base *= 1.18;
    let total = base;
    if ((cat||'').toLowerCase()==='laptops' && base <= 2000){
      total = base + (MARGEN_LOW_LAPTOP_SINIGV * 1.18/1.00); // 118
    }else{
      total = base*(1+RECARGO_PCT) + RECARGO_FIJO;
    }
    return round50(total);
  }

  const fmt = n => 'S/ ' + Number(n||0).toLocaleString('es-PE', {minimumFractionDigits:2, maximumFractionDigits:2});
  const byId = id => document.getElementById(id);
  document.getElementById('y').textContent = new Date().getFullYear();

  // ====== CAROUSEL HERO ======
  const slides = Array.from(document.querySelectorAll('.slide'));
  const dotsWrap = document.getElementById('dots');
  slides.forEach((_,i)=>{ const b=document.createElement('button'); b.addEventListener('click',()=>show(i,true)); dotsWrap.appendChild(b); });
  const dots = Array.from(dotsWrap.querySelectorAll('button'));
  let idx = 0, timer=null;
  function show(i,manual=false){ idx = i; slides.forEach((s,j)=>s.classList.toggle('active', j===i)); dots.forEach((d,j)=>d.classList.toggle('active', j===i)); if(manual){ resetAuto(); } }
  function next(){ show((idx+1)%slides.length); }
  function resetAuto(){ clearInterval(timer); timer=setInterval(next, 4000); }
  show(0); resetAuto();

  // ====== TC auto diario + atajo manual ======
  async function refreshTC(auto=true){
    try{
      const r = await fetch('https://api.exchangerate.host/latest?base=USD&symbols=PEN', {cache:'no-store'});
      const j = await r.json();
      if(!j?.rates?.PEN) throw new Error('Respuesta inv√°lida');
      TC = parseFloat(j.rates.PEN);
      localStorage.setItem('TC_val', String(TC));
      localStorage.setItem('TC_date', new Date().toISOString().slice(0,10));
      if(!auto) alert('TC actualizado: ' + TC.toFixed(3));
      await loadProducts();
    }catch(e){
      if(!auto) alert('No se pudo actualizar TC. Se mantiene: ' + TC.toFixed(3));
      console.warn('TC auto error:', e);
    }
  }
  (async ()=>{
    const today = new Date().toISOString().slice(0,10);
    if(localStorage.getItem('TC_date') !== today){
      await refreshTC(true);
    }
  })();
  function setManualTC(){
    const v = prompt('Nuevo tipo de cambio (USD‚ÜíPEN):', TC.toFixed(3));
    if(!v) return;
    const nv = parseFloat(v.replace(',','.'));
    if(!isNaN(nv) && nv>0){
      TC = nv;
      localStorage.setItem('TC_val', String(TC));
      localStorage.setItem('TC_date', new Date().toISOString().slice(0,10));
      loadProducts();
      alert('TC guardado: ' + TC.toFixed(3));
    }else{
      alert('Valor inv√°lido.');
    }
  }
  document.addEventListener('keydown', (e)=>{ if(e.shiftKey && (e.key==='T' || e.key==='t')) setManualTC(); });

  // ====== Cargar productos ======
  const DATA_FILES = [
    'data/laptops.json',
    'data/refurb.json',
    'data/impresoras.json',
    'data/cctv.json',
    'data/ups.json',
    'data/pcs.json'
  ];
  let products = [];
  let P = {};
  async function loadProducts(){
    products = [];
    for (const url of DATA_FILES){
      try{
        const r = await fetch(url + '?v=' + Date.now());
        if(!r.ok) continue;
        const arr = await r.json();
        products.push(...arr);
      }catch(e){ }
    }
    products = products.map(p=>{
      if (p.cat === 'refurb'){ p.segmento = p.segmento || 'refurb'; p.cat = 'laptops'; }
      p.segmento = (p.segmento || 'consumo').toLowerCase();
      if(!p.precioNum && p.precioCalc){
        const monto = calcFinal(p.precioCalc, p.cat);
        p.precioNum = monto; p.precio = fmt(monto);
      }else if(p.precioNum && !p.precio){
        p.precio = fmt(p.precioNum);
      }
      return p;
    });
    P = Object.fromEntries(products.map(p => [p.id, p]));
    render();
    renderCart();
  }
  loadProducts();

  // ====== Buscador + Orden ======
  let searchTerm = '';
  let orderBy = 'recientes';
  const q = document.getElementById('q');
  const sortSel = document.getElementById('sort');

  q?.addEventListener('input', () => {
    searchTerm = q.value.trim().toLowerCase();
    render(document.querySelector('.tab.active')?.dataset.cat || 'todo');
  });
  sortSel?.addEventListener('change', () => {
    orderBy = sortSel.value;
    render(document.querySelector('.tab.active')?.dataset.cat || 'todo');
  });

  // ====== Segmentos UI ======
  const segBox = byId('segBox');
  const segSet = new Set();
  function refreshSegVisibility(cat){
    segBox.style.display = (cat==='laptops' || cat==='todo') ? '' : 'none';
  }
  document.querySelectorAll('.segchk').forEach(ch=>{
    ch.addEventListener('change', ()=>{
      segSet.clear();
      document.querySelectorAll('.segchk:checked').forEach(c => segSet.add(c.value));
      render(document.querySelector('.tab.active')?.dataset.cat || 'todo');
    });
  });
  byId('segClear').addEventListener('click', ()=>{
    document.querySelectorAll('.segchk').forEach(c=>c.checked=false);
    segSet.clear(); render(document.querySelector('.tab.active')?.dataset.cat || 'todo');
  });

  // ====== Helpers ======
  const isPromo = (p) => {
    const pr = (p.promoId || p.ref || '').toUpperCase();
    return pr.includes('PROMOCION') || pr.includes('PROMO');
  };
  const refDe = (p) => (p.promoId || p.ref || p.codigo || p.fabricanteCod || p.codFabricante || p.minicodigo || '');

  // ====== RENDER TARJETAS + TABS ======
  const grid = byId('productGrid');

  function card(p){
    const ref = refDe(p);
    const inStock = Number(p.stockLima ?? 1) > 0;
    const offer = isPromo(p);
    return `<div class="card item ${inStock ? '' : 'disabled'}">
      <div style="position:relative">
        <img loading="lazy" decoding="async" src="${p.img}" alt="${p.nombre}"
             onerror="this.src='https://picsum.photos/seed/${p.id}/800/500'"/>
        ${offer ? '<span class="offerRibbon">OFERTA</span>' : ''}
        ${ref ? `<span class="codePill">${ref}</span>` : ''}
        ${inStock ? '' : '<span class="soldout">Agotado</span>'}
      </div>
      <h3>${p.nombre}</h3>
      <div class="mini">${p.desc || ''}</div>
      <div class="cta" style="justify-content:space-between;align-items:center">
        <span style="opacity:.9;font-weight:700">${p.precio || ''}</span>
        <div style="display:flex;gap:8px">
          <button type="button" class="pill" onclick="openProduct('${p.id}')">Ver detalles</button>
          <button type="button" class="pill" ${inStock ? '' : 'disabled'} onclick="addToCart('${p.id}')">Agregar</button>
        </div>
      </div>
    </div>`;
  }

  function render(cat='todo'){
    refreshSegVisibility(cat);
    let list = (cat==='todo') ? products.slice() : products.filter(p => p.cat === cat);
    if (segSet.size > 0){
      list = list.filter(p => p.cat!=='laptops' ? true : segSet.has((p.segmento||'consumo')));
    }
    if (searchTerm) {
      list = list.filter(p => {
        const ref = refDe(p);
        const hay = `${p.nombre} ${ref} ${p.desc||''} ${(p.specs||[]).join(' ')}`.toLowerCase();
        return hay.includes(searchTerm);
      });
    }
    switch (orderBy) {
      case 'precio-asc':  list.sort((a,b) => (a.precioNum||0) - (b.precioNum||0)); break;
      case 'precio-desc': list.sort((a,b) => (b.precioNum||0) - (a.precioNum||0)); break;
      case 'nombre-asc':  list.sort((a,b) => a.nombre.localeCompare(b.nombre, 'es')); break;
      case 'nombre-desc': list.sort((a,b) => b.nombre.localeCompare(a.nombre, 'es')); break;
      default: break;
    }
    grid.innerHTML = list.length
      ? list.map(card).join('')
      : '<div class="mini" style="opacity:.8;padding:18px">No hay productos que coincidan.</div>';
  }

  const tabsEl = document.getElementById('tabs');
  tabsEl.querySelectorAll('.tab').forEach(btn => {
    btn.addEventListener('click', () => {
      tabsEl.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
      render(btn.dataset.cat);
    });
  });

  // ====== MODAL PRODUCTO ======
  let CURRENT=null, GALIDX=0;
  function openProduct(id){
    const p = P[id]; if(!p) return; CURRENT=p;
    const ref = refDe(p);
    byId('pdName').textContent = p.nombre;
    byId('pdRef').textContent = ref ? `Referencia: ${ref}` : '';
    byId('pdCat').textContent = ((({laptops:'Laptops', impresoras:'Impresoras', cctv:'C√°maras & CCTV', ups:'UPS', pcs:'PCs'})[p.cat]) || '') + (p.segmento === 'refurb' ? ' ¬∑ Refurb' : '');
    byId('pdPrice').textContent = p.precio || '';
    byId('pdDetalles').textContent = p.detalles || '';
    byId('pdSpecs').innerHTML = (p.specs || []).map(s=>`<li>‚Ä¢ ${s}</li>`).join('');
    byId('pdWA').href = waLink(`Hola, me interesa ${p.nombre} (${p.precio||''})${ref ? ' [REF: ' + ref + ']' : ''}. ¬øDisponibilidad y entrega?`);
    byId('pdAdd').onclick = ()=>addToCart(p.id, 1, true);

    const imgs = (p.imgs && p.imgs.length) ? p.imgs : [p.img];
    GALIDX=0; const main=byId('galMain'), thumbs=byId('galThumbs');
    function set(i){ GALIDX=i; main.src=imgs[i]; thumbs.querySelectorAll('img').forEach((t,idx)=>t.classList.toggle('active', idx===i)); }
    thumbs.innerHTML = imgs.map((src,i)=>`<img src="${src}" alt="thumb ${i+1}" ${i===0?'class="active"':''} />`).join('');
    thumbs.querySelectorAll('img').forEach((el,i)=>el.addEventListener('click', ()=>set(i)));
    set(0);
    byId('galOffer').style.display = isPromo(p) ? 'inline-block' : 'none';
    byId('productModal').classList.add('open'); document.body.style.overflow='hidden';
  }
  function closeProduct(){ byId('productModal').classList.remove('open'); document.body.style.overflow=''; CURRENT=null; }
  function galPrev(){ if(!CURRENT) return; const imgs=(CURRENT.imgs&&CURRENT.imgs.length)?CURRENT.imgs:[CURRENT.img]; GALIDX=(GALIDX-1+imgs.length)%imgs.length; byId('galMain').src=imgs[GALIDX]; document.querySelectorAll('#galThumbs img').forEach((t,idx)=>t.classList.toggle('active', idx===GALIDX)); }
  function galNext(){ if(!CURRENT) return; const imgs=(CURRENT.imgs&&CURRENT.imgs.length)?CURRENT.imgs:[CURRENT.img]; GALIDX=(GALIDX+1)%imgs.length; byId('galMain').src=imgs[GALIDX]; document.querySelectorAll('#galThumbs img').forEach((t,idx)=>t.classList.toggle('active', idx===GALIDX)); }
  window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeProduct(); });

  // ====== CARRITO ======
  const CART_KEY='tecnolap_cart_v1';
  let cart = JSON.parse(localStorage.getItem(CART_KEY)||'[]'); // [{id,qty}]
  const saveCart=()=>localStorage.setItem(CART_KEY, JSON.stringify(cart));
  const countCart=()=>cart.reduce((a,c)=>a+c.qty,0);
  const subtotal=()=>cart.reduce((a,c)=>a+(P[c.id]?.precioNum||0)*c.qty,0);

  function addToCart(id, qty=1, fromModal=false){
    const p=P[id]; if(!p) return;
    const it = cart.find(x=>x.id===id); if(it) it.qty+=qty; else cart.push({id,qty});
    saveCart(); renderCart(); if(fromModal) closeProduct(); openCart();
  }
  function removeFromCart(id){ cart=cart.filter(x=>x.id!==id); saveCart(); renderCart(); }
  function setQty(id, q){ const it=cart.find(x=>x.id===id); if(!it) return; it.qty=q<1?1:q; saveCart(); renderCart(); }

  const drawer = byId('cartDrawer'), overlay=byId('drawerOverlay');
  function openCart(){ drawer.classList.add('open'); overlay.classList.add('open'); }
  function closeCart(){ drawer.classList.remove('open'); overlay.classList.remove('open'); }
  byId('btnCart').onclick=openCart; byId('btnCloseCart').onclick=closeCart; overlay.onclick=closeCart;

  function renderCart(){
    byId('cartCount').textContent = countCart();
    const wrap = byId('cartList');
    if(cart.length===0){
      wrap.innerHTML = `<div class="empty">Tu carrito est√° vac√≠o.</div>`;
      byId('cartSubtotal').textContent=fmt(0);
      byId('cartIGV').textContent=fmt(0);
      byId('cartTotal').textContent=fmt(0);
      return;
    }
    wrap.innerHTML = cart.map(c=>{
      const p=P[c.id]; if(!p) return '';
      return `<div class="cartItem">
        <img src="${p.img}" alt="${p.nombre}" onerror="this.src='https://picsum.photos/seed/${p.id}/160/100'"/>
        <div>
          <div style="font-weight:700">${p.nombre}</div>
          <div class="mini">${p.precio||''}</div>
          <div class="qty" style="margin-top:6px">
            <button onclick="setQty('${c.id}', ${c.qty-1})">‚àí</button>
            <span>${c.qty}</span>
            <button onclick="setQty('${c.id}', ${c.qty+1})">+</button>
          </div>
        </div>
        <div style="text-align:right">
          <div>${fmt((p.precioNum||0)*c.qty)}</div>
          <button class="del" onclick="removeFromCart('${c.id}')">Quitar</button>
        </div>
      </div>`;
    }).join('');

    const sub = subtotal();
    const igv = sub - (sub/1.18);
    const tot = sub;
    byId('cartSubtotal').textContent = fmt(sub);
    byId('cartIGV').textContent = fmt(igv);
    byId('cartTotal').textContent = fmt(tot);
  }
  renderCart();

  byId('btnClear').onclick = ()=>{ cart=[]; saveCart(); renderCart(); };
  byId('btnCheckout').onclick = ()=>{
    if(cart.length===0) return;
    const lines = cart.map(c=>{
      const p=P[c.id];
      const s=fmt((p.precioNum||0)*c.qty);
      const ref = refDe(p);
      return `‚Ä¢ ${p?.nombre} x${c.qty} ‚Äî ${s}${ref ? ' [REF: ' + ref + ']' : ''}`;
    }).join('%0A');
    const msg = `Hola, quiero comprar:%0A${lines}%0A%0ATotal carrito: ${byId('cartTotal').textContent}%0A¬øOpciones de pago y entrega (Lima/Provincias)?`;
    window.open(waLink(msg), '_blank');
  };

  // Abrir producto por hash #p=lap-001
  function checkHash(){ const m=location.hash.match(/#p=([a-z0-9-]+)/i); if(m) openProduct(m[1]); }
  window.addEventListener('hashchange', checkHash); checkHash();

  // ====== Men√∫ m√≥vil toggle ======
  const menuBtn = document.getElementById('menuToggle');
  const nav = document.getElementById('navActions');
  menuBtn?.addEventListener('click', ()=>{ nav.classList.toggle('open'); });
  </script>

  <script defer src="js/share.js"></script>
  <script defer src="js/comments.js"></script>
</body>
</html>
